# 實作案例 5：自動產出成績單 PDF

## 專案概述

本專案將建立一個自動化的成績單產出系統。系統會從 Google Sheets 讀取學生成績資料，使用 Google Docs 範本產生個人化的成績單，並將成績單匯出為 PDF 檔案，自動命名並儲存到指定的 Google Drive 資料夾中。

## 學習目標

- 掌握 SpreadsheetApp 讀取成績資料
- 學習 DocumentApp 操作文件範本
- 實作文件內容替換功能
- 學習將文件匯出為 PDF
- 掌握批次處理多筆資料
- 學習檔案命名與儲存

## 專案功能

### 核心功能

1. **讀取成績資料**
   - 從試算表讀取學生資料
   - 解析成績欄位
   - 計算統計資料

2. **建立文件範本**
   - 設計成績單範本
   - 定義替換標記
   - 設定格式樣式

3. **產生個人成績單**
   - 複製範本文件
   - 替換學生資料
   - 格式化內容

4. **匯出 PDF**
   - 將文件匯出為 PDF
   - 自動命名檔案
   - 儲存到指定資料夾

5. **批次處理**
   - 遍歷所有學生
   - 逐一產生成績單
   - 記錄處理進度

## 使用情境

### 情境 1：學期成績單
- 讀取學期成績資料
- 產生每位學生的成績單
- 匯出 PDF 供列印或寄送

### 情境 2：考試成績通知
- 讀取考試成績
- 產生個人成績報告
- 自動寄送給學生

### 情境 3：證書產出
- 讀取學員資料
- 產生結業證書
- 批次匯出 PDF

## 資料結構設計

### 試算表結構

| 學號 | 姓名 | 班級 | 國文 | 英文 | 數學 | 自然 | 社會 | 平均 | 排名 |
|-----|------|------|------|------|------|------|------|------|------|
| 001 | 王小明 | 一年一班 | 85 | 90 | 88 | 92 | 87 | 88.4 | 5 |
| 002 | 李小華 | 一年一班 | 92 | 88 | 95 | 90 | 93 | 91.6 | 2 |
| 003 | 張小美 | 一年二班 | 78 | 82 | 80 | 85 | 79 | 80.8 | 15 |

### 成績單範本

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
                學期成績單
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

學號：{{學號}}
姓名：{{姓名}}
班級：{{班級}}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
科目成績
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

國文：{{國文}} 分
英文：{{英文}} 分
數學：{{數學}} 分
自然：{{自然}} 分
社會：{{社會}} 分

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
統計資料
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

平均分數：{{平均}} 分
班級排名：第 {{排名}} 名
等級評定：{{等級}}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
導師評語
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

{{評語}}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

發放日期：{{日期}}
```

### 輸出檔案命名

```
成績單_一年一班_001_王小明.pdf
成績單_一年一班_002_李小華.pdf
成績單_一年二班_003_張小美.pdf
```

## 技術要點

### 1. SpreadsheetApp 服務
- `SpreadsheetApp.openById()` - 開啟試算表
- `sheet.getDataRange()` - 取得資料範圍
- `range.getValues()` - 讀取資料

### 2. DocumentApp 服務
- `DocumentApp.openById()` - 開啟文件
- `doc.getBody()` - 取得文件主體
- `body.replaceText()` - 替換文字
- `doc.makeCopy()` - 複製文件

### 3. DriveApp 服務
- `DriveApp.getFileById()` - 取得檔案
- `file.getAs()` - 轉換檔案格式
- `folder.createFile()` - 建立檔案
- `file.setName()` - 設定檔案名稱

### 4. 資料處理
- 讀取試算表資料
- 解析欄位資訊
- 計算統計資料
- 格式化輸出

## 開發步驟

### 步驟 1：準備成績資料
1. 建立成績試算表
2. 輸入學生資料
3. 計算平均與排名

### 步驟 2：建立文件範本
1. 建立 Google Docs 文件
2. 設計成績單格式
3. 插入替換標記

### 步驟 3：讀取成績資料
1. 連接試算表
2. 讀取所有學生資料
3. 解析欄位資訊

### 步驟 4：產生成績單
1. 複製範本文件
2. 替換學生資料
3. 格式化內容

### 步驟 5：匯出 PDF
1. 將文件轉換為 PDF
2. 設定檔案名稱
3. 儲存到資料夾

### 步驟 6：批次處理
1. 遍歷所有學生
2. 逐一產生成績單
3. 記錄處理結果

## 預期成果

完成本專案後，你將擁有：

1. ✅ 自動化的成績單產出系統
2. ✅ 文件範本替換功能
3. ✅ PDF 匯出功能
4. ✅ 批次處理功能
5. ✅ 可重複使用的程式碼範本

## 延伸功能

完成基本功能後，可以嘗試以下延伸功能：

1. **自動寄送成績單**
   - 產生 PDF 後自動寄送給學生
   - 包含個人化的郵件內容

2. **成績分析圖表**
   - 在成績單中加入圖表
   - 顯示成績趨勢

3. **多種範本支援**
   - 支援不同格式的範本
   - 根據需求選擇範本

4. **數位簽章**
   - 在 PDF 中加入數位簽章
   - 確保文件真實性

5. **雲端儲存整合**
   - 自動上傳到特定資料夾
   - 設定檔案權限

## 注意事項

1. **權限設定**
   - 確保有權限存取試算表和文件
   - 測試時使用自己的檔案

2. **資料驗證**
   - 檢查成績資料的完整性
   - 處理空值或異常值

3. **範本設計**
   - 替換標記要明確且唯一
   - 使用 {{標記}} 格式

4. **效能考量**
   - 大量學生時注意執行時間
   - 考慮分批處理

5. **檔案管理**
   - 定期清理舊的成績單
   - 建立清楚的資料夾結構

## 相關資源

- [DocumentApp 官方文件](https://developers.google.com/apps-script/reference/document/document-app)
- [SpreadsheetApp 官方文件](https://developers.google.com/apps-script/reference/spreadsheet/spreadsheet-app)
- [DriveApp 官方文件](https://developers.google.com/apps-script/reference/drive/drive-app)
- [PDF 匯出指南](https://developers.google.com/apps-script/reference/drive/file#getAsblob)

## 下一步

完成本專案後，建議：

1. 閱讀完整的實作指引文件
2. 跟著步驟逐步實作
3. 測試每個功能模組
4. 嘗試延伸功能
5. 應用到實際場景

開始實作前，請先閱讀 `implementation-guide.md` 了解詳細的開發步驟。
