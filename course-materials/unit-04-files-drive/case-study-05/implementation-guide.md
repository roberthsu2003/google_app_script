# 實作案例 5：自動產出成績單 PDF - 實作指引

## 快速開始

### 1. 初始化設定

執行 `initialize()` 函式，這會自動建立：
- 成績試算表（含測試資料）
- 成績單範本文件
- PDF 輸出資料夾

```
=== 初始化設定 ===

步驟 1：建立成績試算表
✅ 成績試算表已建立
試算表 ID：1ABC...XYZ
試算表 URL：https://docs.google.com/spreadsheets/d/...

步驟 2：建立範本文件
✅ 範本文件已建立
文件 ID：1DEF...UVW
文件 URL：https://docs.google.com/document/d/...

步驟 3：建立輸出資料夾
✅ 輸出資料夾已建立
資料夾 ID：1GHI...RST
資料夾 URL：https://drive.google.com/drive/folders/...

========================================
初始化完成！
========================================

下一步：
1. 將上方顯示的 ID 複製到程式碼中
2. 執行 generateAllReportCards() 產生成績單
```

### 2. 設定 ID

將執行記錄中的 ID 複製到程式碼開頭：

```javascript
var SPREADSHEET_ID = '1ABC...XYZ';  // 成績試算表 ID
var TEMPLATE_DOC_ID = '1DEF...UVW';  // 範本文件 ID
var OUTPUT_FOLDER_ID = '1GHI...RST';  // 輸出資料夾 ID
```

### 3. 測試單一成績單

執行 `generateSingleReportCard()` 測試功能：

```
=== 產生單一成績單 ===
學生：王小明 (001)

✅ 成功產生成績單
檔案名稱：成績單_一年一班_001_王小明.pdf
檔案 URL：https://drive.google.com/file/d/...
```

### 4. 批次產生所有成績單

執行 `generateAllReportCards()` 產生所有學生的成績單：

```
=== 開始批次產生成績單 ===

✅ 已讀取 5 位學生的資料

=== 開始產生 PDF ===

1. 處理：王小明 (001)
   ✅ 成功：成績單_一年一班_001_王小明.pdf
   URL：https://drive.google.com/file/d/...

2. 處理：李小華 (002)
   ✅ 成功：成績單_一年一班_002_李小華.pdf
   URL：https://drive.google.com/file/d/...

3. 處理：張小美 (003)
   ✅ 成功：成績單_一年二班_003_張小美.pdf
   URL：https://drive.google.com/file/d/...

4. 處理：陳大明 (004)
   ✅ 成功：成績單_一年二班_004_陳大明.pdf
   URL：https://drive.google.com/file/d/...

5. 處理：林小芳 (005)
   ✅ 成功：成績單_一年一班_005_林小芳.pdf
   URL：https://drive.google.com/file/d/...

========================================
=== 批次處理完成 ===
========================================

總學生數：5
成功：5
失敗：0
執行時間：15.32 秒

輸出資料夾：
https://drive.google.com/drive/folders/...
```

### 5. 檢查結果

開啟輸出資料夾，應該看到所有學生的成績單 PDF：

```
成績單 PDF
├── 成績單_一年一班_001_王小明.pdf
├── 成績單_一年一班_002_李小華.pdf
├── 成績單_一年二班_003_張小美.pdf
├── 成績單_一年二班_004_陳大明.pdf
└── 成績單_一年一班_005_林小芳.pdf
```

## 程式碼說明

### 核心函式

#### 1. createTemplate()
建立成績單範本文件，包含所有替換標記。

#### 2. getStudentData()
從試算表讀取學生資料，並計算等級和評語。

#### 3. generateReportCard(student)
為單一學生產生成績單 PDF：
1. 複製範本文件
2. 替換學生資料
3. 匯出為 PDF
4. 儲存到資料夾
5. 刪除臨時文件

#### 4. generateAllReportCards()
批次處理所有學生，產生所有成績單。

## 自訂範本

### 修改範本內容

1. 開啟範本文件 URL
2. 編輯內容和格式
3. 使用 `{{標記}}` 格式插入替換標記
4. 儲存文件

### 可用的替換標記

- `{{學號}}` - 學生學號
- `{{姓名}}` - 學生姓名
- `{{班級}}` - 班級
- `{{國文}}` - 國文成績
- `{{英文}}` - 英文成績
- `{{數學}}` - 數學成績
- `{{自然}}` - 自然成績
- `{{���會}}` - 社會成績
- `{{平均}}` - 平均分數
- `{{排名}}` - 班級排名
- `{{等級}}` - 等級評定
- `{{評語}}` - 導師評語
- `{{日期}}` - 發放日期

## 延伸功能

### 1. 自動寄送成績單

在 `generateReportCard()` 後加入寄送郵件：

```javascript
// 寄送成績單給學生
MailApp.sendEmail({
  to: student.Email,  // 需在試算表中加入 Email 欄位
  subject: '學期成績單',
  body: '親愛的 ' + student.姓名 + '，\n\n您的學期成績單已產生，請查看附件。',
  attachments: [pdfFile.getBlob()]
});
```

### 2. 加入圖表

在範本中插入成績圖表（需手動建立）。

### 3. 多種範本

根據不同需求使用不同範本：

```javascript
var templateId = student.班級.includes('一年') ? TEMPLATE_1 : TEMPLATE_2;
```

## 常見問題

### Q1：PDF 沒有產生

**解決方案：** 檢查所有 ID 是否正確設定

### Q2：替換標記沒有被替換

**解決方案：** 確認標記格式為 `{{標記}}`，且與程式碼中的 key 一致

### Q3：執行時間過長

**解決方案：** 
- 減少學生數量
- 移除 `Utilities.sleep()`
- 分批處理

### Q4：權限錯誤

**解決方案：** 確保有權限存取所有檔案

## 總結

你已經完成了自動產出成績單 PDF 系統！

這個系統可以：
- ✅ 自動讀取成績資料
- ✅ 使用範本產生成績單
- ✅ 匯出為 PDF
- ✅ 批次處理所有學生
- ✅ 自動命名和儲存

繼續探索更多功能，讓你的系統更加完善！
