# 簡易簽到系統 - 實作指引

## 概述

本指引將帶領您一步步完成簡易簽到系統的建置。完成後，您將擁有一個功能完整的簽到系統，包含自動判斷準時/遲到、發送確認郵件、產生統計報表等功能。

## 預計完成時間

約 1.5 小時

## 前置準備

- Google 帳號
- 基本的 JavaScript 知識
- 已完成 FormApp 與觸發器教學

## 實作步驟

### 步驟 1：建立簽到表單與試算表（15 分鐘）

#### 1.1 開啟 Google Apps Script

1. 前往 [Google Apps Script](https://script.google.com/)
2. 點選「新專案」
3. 將專案命名為「簽到系統」

#### 1.2 貼上建立表單的程式碼

將 `Code.gs` 中的所有程式碼複製到編輯器中。

#### 1.3 執行建立函式

1. 選擇函式：`createAttendanceForm`
2. 點選「執行」
3. 首次執行需要授權，點選「審查權限」
4. 選擇您的 Google 帳號
5. 點選「進階」→「前往簽到系統（不安全）」→「允許」
6. 查看執行記錄，複製表單連結與試算表連結

#### 1.4 檢查建立結果

1. 開啟表單連結，確認表單包含：
   - 姓名欄位
   - Email 欄位
   - 備註欄位
2. 開啟試算表連結，確認包含：
   - 「簽到記錄」工作表
   - 「每日統計」工作表

### 步驟 2：設定表單觸發器（10 分鐘）

#### 2.1 開啟試算表的 Apps Script

1. 開啟剛才建立的試算表
2. 點選「擴充功能」→「Apps Script」
3. 將 `Code.gs` 的所有程式碼複製到編輯器中
4. 儲存專案（Ctrl+S 或 Cmd+S）

#### 2.2 執行觸發器設定

1. 選擇函式：`setupAttendanceTrigger`
2. 點選「執行」
3. 查看執行記錄，確認「簽到觸發器已建立成功！」

#### 2.3 驗證觸發器

1. 點選左側的「觸發條件」（時鐘圖示）
2. 確認看到一個觸發器：
   - 函式：`onAttendanceSubmit`
   - 事件來源：來自試算表
   - 事件類型：提交表單時

### 步驟 3：測試簽到功能（20 分鐘）

#### 3.1 測試準時簽到

1. 開啟表單連結
2. 填寫資料：
   - 姓名：測試使用者 1
   - Email：您的 Email
   - 備註：測試準時簽到
3. 提交表單
4. 檢查試算表：
   - 應該看到新的一列資料
   - 狀態欄位應為「準時」（如果在 09:00 前）
   - 背景顏色應為淺綠色
5. 檢查 Email：
   - 應該收到確認郵件
   - 郵件標題包含「準時」

#### 3.2 測試遲到簽到

如果現在時間已超過 09:00，重複上述步驟，應該看到：
- 狀態欄位為「遲到」
- 背景顏色為淺紅色
- 確認郵件標題包含「遲到」

#### 3.3 測試時間判斷邏輯

執行測試函式：
1. 選擇函式：`testAttendanceSystem`
2. 點選「執行」
3. 查看執行記錄，確認時間判斷正確

### 步驟 4：產生每日統計（15 分鐘）

#### 4.1 手動產生統計

1. 確保已有至少 2-3 筆簽到記錄
2. 選擇函式：`generateDailyStatistics`
3. 點選「執行」
4. 查看執行記錄，確認統計數據
5. 開啟試算表的「每日統計」工作表
6. 確認看到今天的統計資料

#### 4.2 設定自動統計（選擇性）

1. 選擇函式：`setupDailyStatisticsTrigger`
2. 點選「執行」
3. 點選左側的「觸發條件」
4. 確認看到每日統計的觸發器（每天 23:00 執行）

### 步驟 5：測試查詢功能（10 分鐘）

#### 5.1 查詢特定日期

1. 修改函式，加入測試程式碼：

```javascript
function testQueryByDate() {
  var today = Utilities.formatDate(new Date(), 'GMT+8', 'yyyy-MM-dd');
  var results = queryAttendanceByDate(today);
  Logger.log('今天的簽到記錄：' + results.length + ' 筆');
}
```

2. 執行 `testQueryByDate`
3. 查看執行記錄

#### 5.2 查詢特定人員

1. 修改函式：

```javascript
function testQueryByName() {
  var results = queryAttendanceByName('測試使用者 1');
  Logger.log('查詢結果：' + results.length + ' 筆');
}
```

2. 執行 `testQueryByName`
3. 查看執行記錄

## 常見問題排除

### 問題 1：觸發器沒有執行

**症狀**：提交表單後，試算表沒有自動更新狀態

**解決方案**：
1. 檢查觸發器是否正確建立（點選「觸發條件」）
2. 查看「執行作業」，確認是否有錯誤訊息
3. 確認程式碼是在試算表的 Apps Script 中，而非獨立專案

### 問題 2：沒有收到確認郵件

**症狀**：簽到成功但沒收到郵件

**解決方案**：
1. 檢查垃圾郵件資料夾
2. 確認表單有設定收集 Email
3. 查看執行記錄，確認郵件發送是否成功
4. 檢查是否超過每日郵件配額

### 問題 3：時間判斷不正確

**症狀**：09:00 前簽到卻顯示遲到

**解決方案**：
1. 檢查時區設定（應為 GMT+8）
2. 執行 `testAttendanceSystem` 測試時間判斷邏輯
3. 確認 `ON_TIME_HOUR` 和 `ON_TIME_MINUTE` 設定正確

### 問題 4：統計數據不正確

**症狀**：統計報表的數字與實際不符

**解決方案**：
1. 確認「狀態」欄位的位置正確
2. 檢查是否有手動修改過試算表結構
3. 重新執行 `generateDailyStatistics`

## 進階功能擴展

### 擴展 1：新增請假功能

在表單中新增「請假」選項，修改狀態判斷邏輯。

### 擴展 2：連續準時獎勵

統計每個人的連續準時天數，達到目標時發送獎勵通知。

### 擴展 3：簽退功能

新增簽退表單，記錄離開時間。

### 擴展 4：個人查詢頁面

建立 Web App，讓使用者可以查詢自己的簽到記錄。

### 擴展 5：管理員通知

當遲到人數超過閾值時，自動通知管理員。

## 學習重點回顧

完成本實作案例後，您應該掌握：

1. ✅ 如何建立完整的表單應用
2. ✅ 如何設定並使用表單觸發器
3. ✅ 如何處理日期時間判斷
4. ✅ 如何自動發送郵件通知
5. ✅ 如何產生統計報表
6. ✅ 如何進行錯誤處理與除錯

## 下一步

- 嘗試自行擴展功能
- 學習建立 Web App（單元 6）
- 整合更多 Google 服務

## 參考資源

- FormApp 官方文件
- 觸發器說明文件
- 日期時間處理教學
