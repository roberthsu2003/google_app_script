<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <title>前後端互動範例</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 30px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .section {
        background: white;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      h2 {
        color: #4285f4;
        margin-top: 0;
      }
      button {
        background: #4285f4;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 10px;
      }
      button:hover {
        background: #357ae8;
      }
      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      input {
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-right: 10px;
      }
      .result {
        margin-top: 15px;
        padding: 10px;
        background: #e8f5e9;
        border-left: 4px solid #4caf50;
        border-radius: 4px;
      }
      .error {
        margin-top: 15px;
        padding: 10px;
        background: #ffebee;
        border-left: 4px solid #f44336;
        border-radius: 4px;
      }
      .loading {
        color: #666;
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <h1>前後端互動範例</h1>
    
    <!-- 範例 1：簡單呼叫 -->
    <div class="section">
      <h2>範例 1：簡單呼叫</h2>
      <button onclick="example1()">取得訊息</button>
      <div id="result1"></div>
    </div>
    
    <!-- 範例 2：傳遞參數 -->
    <div class="section">
      <h2>範例 2：傳遞參數</h2>
      <input type="text" id="name" placeholder="輸入姓名">
      <button onclick="example2()">問候</button>
      <div id="result2"></div>
    </div>
    
    <!-- 範例 3：數學運算 -->
    <div class="section">
      <h2>範例 3：數學運算</h2>
      <input type="number" id="num1" placeholder="數字 1" value="5">
      <input type="number" id="num2" placeholder="數字 2" value="10">
      <button onclick="example3Add()">相加</button>
      <button onclick="example3Multiply()">相乘</button>
      <div id="result3"></div>
    </div>
    
    <!-- 範例 4：處理物件 -->
    <div class="section">
      <h2>範例 4：處理物件</h2>
      <button onclick="example4()">發送使用者資料</button>
      <div id="result4"></div>
    </div>
    
    <!-- 範例 5：錯誤處理 -->
    <div class="section">
      <h2>範例 5：錯誤處理</h2>
      <input type="number" id="divNum1" placeholder="被除數" value="10">
      <input type="number" id="divNum2" placeholder="除數" value="2">
      <button onclick="example5()">除法運算</button>
      <div id="result5"></div>
    </div>
    
    <!-- 範例 6：載入狀態 -->
    <div class="section">
      <h2>範例 6：載入狀態</h2>
      <button id="longTaskBtn" onclick="example6()">執行耗時任務</button>
      <div id="result6"></div>
    </div>
    
    <!-- 範例 7：搜尋功能 -->
    <div class="section">
      <h2>範例 7：搜尋功能</h2>
      <input type="text" id="searchKeyword" placeholder="輸入關鍵字">
      <button onclick="example7()">搜尋</button>
      <div id="result7"></div>
    </div>
    
    <script>
      // 範例 1：簡單呼叫
      function example1() {
        google.script.run
          .withSuccessHandler(function(result) {
            document.getElementById('result1').innerHTML = 
              '<div class="result">伺服器回應：' + result + '</div>';
          })
          .getMessage();
      }
      
      // 範例 2：傳遞參數
      function example2() {
        var name = document.getElementById('name').value;
        if (!name) {
          alert('請輸入姓名');
          return;
        }
        
        google.script.run
          .withSuccessHandler(function(result) {
            document.getElementById('result2').innerHTML = 
              '<div class="result">' + result + '</div>';
          })
          .greetUser(name);
      }
      
      // 範例 3：數學運算
      function example3Add() {
        var num1 = parseFloat(document.getElementById('num1').value);
        var num2 = parseFloat(document.getElementById('num2').value);
        
        google.script.run
          .withSuccessHandler(function(result) {
            document.getElementById('result3').innerHTML = 
              '<div class="result">' + num1 + ' + ' + num2 + ' = ' + result + '</div>';
          })
          .addNumbers(num1, num2);
      }
      
      function example3Multiply() {
        var num1 = parseFloat(document.getElementById('num1').value);
        var num2 = parseFloat(document.getElementById('num2').value);
        
        google.script.run
          .withSuccessHandler(function(result) {
            document.getElementById('result3').innerHTML = 
              '<div class="result">' + num1 + ' × ' + num2 + ' = ' + result + '</div>';
          })
          .multiplyNumbers(num1, num2);
      }
      
      // 範例 4：處理物件
      function example4() {
        var user = {
          name: 'John Doe',
          email: 'john@example.com',
          age: 25
        };
        
        google.script.run
          .withSuccessHandler(function(result) {
            document.getElementById('result4').innerHTML = 
              '<div class="result">' +
              '<strong>成功：</strong>' + result.message + '<br>' +
              '<strong>時間：</strong>' + result.timestamp +
              '</div>';
          })
          .processUser(user);
      }
      
      // 範例 5：錯誤處理
      function example5() {
        var num1 = parseFloat(document.getElementById('divNum1').value);
        var num2 = parseFloat(document.getElementById('divNum2').value);
        
        google.script.run
          .withSuccessHandler(function(result) {
            document.getElementById('result5').innerHTML = 
              '<div class="result">' + num1 + ' ÷ ' + num2 + ' = ' + result + '</div>';
          })
          .withFailureHandler(function(error) {
            document.getElementById('result5').innerHTML = 
              '<div class="error"><strong>錯誤：</strong>' + error.message + '</div>';
          })
          .divideNumbers(num1, num2);
      }
      
      // 範例 6：載入狀態
      function example6() {
        var btn = document.getElementById('longTaskBtn');
        var resultDiv = document.getElementById('result6');
        
        // 禁用按鈕並顯示載入狀態
        btn.disabled = true;
        btn.textContent = '執行中...';
        resultDiv.innerHTML = '<div class="loading">處理中，請稍候...</div>';
        
        google.script.run
          .withSuccessHandler(function(result) {
            btn.disabled = false;
            btn.textContent = '執行耗時任務';
            resultDiv.innerHTML = '<div class="result">' + result + '</div>';
          })
          .withFailureHandler(function(error) {
            btn.disabled = false;
            btn.textContent = '執行耗時任務';
            resultDiv.innerHTML = '<div class="error">' + error.message + '</div>';
          })
          .longRunningTask();
      }
      
      // 範例 7：搜尋功能
      function example7() {
        var keyword = document.getElementById('searchKeyword').value;
        if (!keyword) {
          alert('請輸入搜尋關鍵字');
          return;
        }
        
        google.script.run
          .withSuccessHandler(function(result) {
            var html = '<div class="result">' +
                      '<strong>搜尋關鍵字：</strong>' + result.keyword + '<br>' +
                      '<strong>找到：</strong>' + result.count + ' 筆結果<br><br>';
            
            if (result.results.length > 0) {
              html += '<ul>';
              result.results.forEach(function(student) {
                html += '<li>' + student.id + ' - ' + student.name + ' (' + student.class + '班)</li>';
              });
              html += '</ul>';
            }
            
            html += '</div>';
            document.getElementById('result7').innerHTML = html;
          })
          .searchStudents(keyword);
      }
    </script>
  </body>
</html>
```
